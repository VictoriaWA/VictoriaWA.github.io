
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Victoria Workforce Analytics</title>

    <meta property="og:title" content="Victoria Workforce Analytics" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://bit.ly/RKAbreCL" />
    <meta property="og:image" content="http://dcc.uchile.cl/~egraells/abrecl/stgo-flow.png" />


    <script src="libs/jquery-1.11.1.min.js"></script>
    <script src="bootstrap-3.3.1-dist/js/bootstrap.min.js"></script>
    <script src="libs/d3.v3.min.js"></script>
    <script src="libs/d3.slider.js"></script>
    <script src="libs/underscore.js"></script>


    <!-- Bootstrap core CSS -->
    <link href="bootstrap-3.3.1-dist/css/bootstrap-cosmo.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="jumbotron-narrow.css" rel="stylesheet">
    <link href="libs/d3.slider.css" rel="stylesheet"  />
    <style type="text/css">

    circle {
      stroke: black;
      stroke-width: 2px;
      opacity: .8;
    }
    .btn-group {
      margin-left: 330px;
    }
    .label {
      fill: black;
      font-size: 16px;
    }
    </style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="container">
      <div class="header">
        <h3 class="text-muted">Victoria Workforce Analytics</h3>
      </div>



        <h2 id="sec-comunas">Indicadores medidos en Tienda [Junio a Octubre 2016]</h2>

        <p>La siguiente visualización permite evaluar la eficiencia, productividad y optimización de la dotación asignada a cada tienda. Además permite comparar el punto de operación de cada tienda con respecto al resto, dejando en evidencia de manera clara los casos más críticos.</p>


        <p>Para ver el detalle de cada mes es necesario utilizar el selector ubicado sobre el cuadro de información. Al pasar el cursor sobre cada círculo se despliega el nombre de la tienda correspondiente.</p>

      <div class="panel panel-default">
          <div class="panel-heading"><h4>Evolución Indicadores de Desempeño</h4>
            <div id="slider12" class="pull-right" style="width: 50%; margin-top: -35px; margin-right: 50px"></div>
            <p></p>
          </div>
          <div id="comunas-casen">
              <div id="comunas-barras" class="pull-right"></div>
              <div id="comunas-texto" style="margin-left: 30px; margin-top: 20px;">
                <p>&nbsp;</p>
                <p>&nbsp;</p>
                <ul class="list-unstyled">
                <li><code>Sales Productivity [SalesP]</code>: <b>Ventas/Tráfico</b> - Mide que tan productiva fue la tienda con respecto a su volumen de clientes.</li>
                <li>&nbsp;</li>
                <li>&nbsp;</li>
                <li>&nbsp;</li>
                <li>&nbsp;</li>
                <li><code>Conversion [Conv]</code>: <b>Nº Boletas/Tráfico</b> - Caracteriza cuántos clientes realizaron compras, midiendo la eficiencia de los vendedores.</li>
                <li>&nbsp;</li>
                <li>&nbsp;</li>
                <li>&nbsp;</li>
                <li>&nbsp;</li>
                <li><code>Staff Availability [STAR]</code>: <b>Horas Hombre/Tráfico</b> - Caracteriza cuántos vendedores estaban disponibles respecto al número de clientes, midiendo que tán óptima es la dotación presente.</li>
                <li>&nbsp;</li>
                <li>&nbsp;</li>
                <li>&nbsp;</li>
                <li><code>Labor Cost [Cost]</code>: <b>Productividad Costo/Productividad Venta</b> - Mide que tan eficiente en términos de costos fue cada tienda.</li>
                </ul>
              </div>
              <div class="clearfix"></div>
          </div>
      </div>

      <footer class="footer">
        <p>Última actualización: <em>21 de Noviembre de 2016</em>. Datos obtenidos desde plataformas ShopperTrak y Victoria.</p>

      </footer>

    </div> <!-- /container -->

    <script type="text/javascript">
    d3.csv('data/datos5.csv', function (error, data) {

    var width = 600, height = 550;
    var fill = d3.scale.ordinal()
          .domain(["low", "medium", "high"])
          .range(["#d84b2a", "#beccae", "#7aa25c"]);

    var svg = d3.select("#comunas-barras").append("svg")
        .attr("width", width)
        .attr("height", height);

    //var max_amount = d3.max(data, function (d) { return parseInt(d.total_amount)})
    //var radius_scale = d3.scale.pow().exponent(0.5).domain([0, max_amount]).range([2, 85])

    _.each(data, function (elem) {
      elem.radius = 10;
      elem.all = 'all';
      elem.x = _.random(0, width);
      elem.y = _.random(0, height);
    })

    essai = d3.slider().scale(d3.scale.ordinal().domain(["Junio", "Julio", "Agosto", "Septiembre", "Octubre"]).rangePoints([0, 1], 0.5)).axis(d3.svg.axis()).snap(true).value("Junio").on("slide", function(evt, value) {
      nodes.transition().delay(0).duration(0)
             //.filter(function(d) { return d.month == "Julio" })
             .attr("r", function (d) {

                 return 0;
                });
      draw(value);
      nodes.transition().delay(0).duration(5000)
             //.filter(function(d) { return d.month == "Julio" })
             .attr("r", function (d) {
               if(d.month == value){
                 return d.radius;
               } });
    });
    d3.select('#slider12').call(essai);

    var padding = 0;
    var maxRadius = d3.max(_.pluck(data, 'radius'));

    var jun_centers = {
                  "SalesPMalo": { name: "BAJO" , x: 50, y: 75 },
                  "SalesPRegular": { name: "REGULAR" , x: 250, y: 75 },
                  "SalesPBueno": { name: "ALTO" , x: 450, y: 75 },
                  "ConversionMalo": { name: "" , x: 50, y: 205 },
                  "ConversionRegular": { name: "" , x: 250, y: 205 },
                  "ConversionBueno": { name: "" , x: 450, y: 205 },
                  "StarMalo": { name: "" , x: 50, y: 335 },
                  "StarRegular": { name: "" , x: 250, y: 335 },
                  "StarBueno": { name: "" , x: 450, y: 335 },
                  "EficienciaMalo": { name: "" , x: 50, y: 465 },
                  "EficienciaRegular": { name: "" , x: 250, y: 465 },
                  "EficienciaBueno": { name: "" , x: 450, y: 465 }
        }

    var jul_centers = {
      "SalesPMalo": { name: "BAJO" , x: 50, y: 75 },
      "SalesPRegular": { name: "REGULAR" , x: 250, y: 75 },
      "SalesPBueno": { name: "ALTO" , x: 450, y: 75 },
      "ConversionMalo": { name: "" , x: 50, y: 205 },
      "ConversionRegular": { name: "" , x: 250, y: 205 },
      "ConversionBueno": { name: "" , x: 450, y: 205 },
      "StarMalo": { name: "" , x: 50, y: 335 },
      "StarRegular": { name: "" , x: 250, y: 335 },
      "StarBueno": { name: "" , x: 450, y: 335 },
      "EficienciaMalo": { name: "" , x: 50, y: 465 },
      "EficienciaRegular": { name: "" , x: 250, y: 465 },
      "EficienciaBueno": { name: "" , x: 450, y: 465 }
        }

    var nodes = svg.selectAll("circle")
      .data(data);

    nodes.enter()
      .append("circle")
      //.filter(function(d) { return d.month == "Julio" })
      .attr("class", "node")
      .attr("cx", function (d) { return d.x; })
      .attr("cy", function (d) { return d.y; })
      .attr("r", 0)
      .style("fill", function (d) { return fill(d.group); })
      .on("mouseover", function (d) { showPopover.call(this, d); })
      .on("mouseout", function (d) { removePopovers(); });



    var force = d3.layout.force();

    draw("Junio");

    nodes.transition().delay(500).duration(5000)
           //.filter(function(d) { return d.month == "Julio" })
           .attr("r", function (d) {
             if(d.month == "Junio"){
               return d.radius;
             } });


    function draw (varname) {
      //var centers = getCenters(varname, [1000, 400]);
      if (varname == "Junio"){
        var foci = jun_centers;
      }
      else {
        var foci = jul_centers;
      }
      //var foci = varname === "Junio" ? jun_centers: jul_centers;
      force.on("tick", tick(foci, varname));
      labels(foci)
      force.start();
    }

    function tick (foci, varname) {
          return function (e) {
            for (var i = 0; i < data.length; i++) {
              var o = data[i];
              if(o['month']==varname){
                var f = foci[o['Category']];
                o.y += (f.y - o.y) * e.alpha;
                o.x += (f.x - o.x) * e.alpha;
              }
            }
            nodes
              .each(collide(.1))
              .attr("cx", function (d) { return d.x; })
              .attr("cy", function (d) { return d.y; });
          }
        }

        function labels (foci) {
          svg.selectAll(".label").remove();

          svg.selectAll(".label")
          .data(_.toArray(foci)).enter().append("text")
          .attr("class", "label")
          .text(function (d) { return d.name })
          .attr("transform", function (d) {
            return "translate(" + (d.x - ((d.name.length)*3)) + ", " + (d.y - 60) + ")";
          });
        }

    function removePopovers () {
      $('.popover').each(function() {
        $(this).remove();
      });
    }

    function showPopover (d) {
      $(this).popover({
        placement: 'auto top',
        container: 'body',
        trigger: 'manual',
        html : true,
        content: function() {
          //return "Store: " + d.Store + "<br/>SalesP: " + d.SalesP +
          //       "<br/>Conversion: " + d.Conversion + "<br/>STARP: " + d.StarP +
          //       "<br/>Eficiencia: " + d.Eficiencia;

          return "" + d.Store;
        }
      });
      $(this).popover('show')

    }

    function collide(alpha) {
      var quadtree = d3.geom.quadtree(data);
      return function (d) {
        var r = d.radius + maxRadius + padding,
            nx1 = d.x - r,
            nx2 = d.x + r,
            ny1 = d.y - r,
            ny2 = d.y + r;
        quadtree.visit(function(quad, x1, y1, x2, y2) {
          if (quad.point && (quad.point !== d)) {
            var x = d.x - quad.point.x,
                y = d.y - quad.point.y,
                l = Math.sqrt(x * x + y * y),
                r = d.radius + quad.point.radius + padding;
            if (l < r) {
              l = (l - r) / l * alpha;
              d.x -= x *= l;
              d.y -= y *= l;
              quad.point.x += x;
              quad.point.y += y;
            }
          }
          return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
        });
      };
    }
  });




</script>
  </body>
</html>
